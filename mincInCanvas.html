<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script src="pako.js"></script>
    <script src="hdf5_tools.js"></script>
    <script src="hdf5_reader.js"></script>
    <script src="minc_reader.js"></script>

</head>
<body>

    <input type="file" id="myFile">

    <canvas id="myCanvas"></canvas>
    <canvas id="myCanvas2"></canvas>

    <script>

    /*
    var canvas = document.getElementById("myCanvas");
    var context = canvas.getContext("2d");

    canvas.width = 200;
    canvas.height = 150;

    context.fillStyle = "#00ff00";
    context.fillRect(0, 0, canvas.width, canvas.height);
    */


    function openHdf5(buffer){
        myMinc = readMincBuffer(buffer);
        console.log("loaded");

        aSlice = myMinc.slice("xspace", 150);
        //console.log(aSlice);
        //console.log(aSlice.getValue(120, 150));


        imageData = myMinc.getSliceImageNoColorMap(aSlice);
        loadImageDataIntoCanvas(imageData, "myCanvas");

        //var dimensions = myMinc.getDimensionInfo();
        //console.log(dimensions);
    }


    function loadImageDataIntoCanvas(imgData, canvasName){
      //var canvas = document.createElement("canvas");
      var canvas = document.getElementById(canvasName);
      var context = canvas.getContext("2d");

      canvas.width = imgData.width;
      canvas.height = imgData.height;

      context.fillStyle = "#00ff00";
      context.fillRect(0, 0, canvas.width, canvas.height);
      context.putImageData(imgData, 0, 0);
    }

    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object

        // Loop through the FileList and render image files as thumbnails.
        for (var i = 0, f; f = files[i]; i++) {
            var reader = new FileReader();

            reader.onloadend = function(event) {
                var result = event.target.result;
                openHdf5(result);
            }

            reader.onerror = function() {
                var error_message = "error reading file: " + filename;

                BrainBrowser.events.triggerEvent("error", { message: error_message });
                throw new Error(error_message);
            };

            reader.readAsArrayBuffer(files[i]);

        }
    }


    // Check for the various File API support.
    if (window.File && window.FileReader && window.FileList && window.Blob) {
        // Great success! All the File APIs are supported.
        document.getElementById('myFile').addEventListener('change', handleFileSelect, false);
    } else {
        console.log('The File APIs are not fully supported in this browser.');
    }





    </script>

</body>
</html>
